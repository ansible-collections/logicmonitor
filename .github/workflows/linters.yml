---
on: [push, pull_request]
name: Linters
jobs:
  linters:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install OS deps
        run: |
          sudo apt-get update -y
          sudo apt-get install -y jq libyaml-dev git build-essential findutils libsystemd-dev

      # >>> Workaround: overlay packaging 25.0 without uninstalling Debian's 24.0
      - name: Pre-install packaging 25.0 (ignore-installed)
        run: |
          python3 --version
          which python3
          python3 -m pip --version
          sudo python3 -m pip install --upgrade --ignore-installed 'packaging==25.0'
          sudo python3 -m pip install --upgrade pip virtualenv setuptools

      - name: Install Python deps for linters
        run: |
          sudo python3 -m pip install -r test_requirements.txt

      - name: Run tox environments
        run: tox